#!/usr/bin/env perl

use strict;
use warnings;
use Getopt::Long;

if (__FILE__ eq $0) {
   # Some default option values
   my %options = ('prefix' => '/usr/local',
	       'cmdname' => '-r');

   if (@ARGV) {
      GetOptions ('help|h' => \$options{help},
		  'prefix=s' => \$options{prefix},
		  'bindir=s' => \$options{bindir},
		  'cmdname=s' => \$options{cmdname});
   }

   if ($options{help}) {
      my $progname = (split '/', $0)[-1];
      print
	sprintf ("%s\n" x 5,
		 "Usage: $progname [options]",
		 "\t--prefix=PATH\t\tSet the installation root path.",
		 "\t--bindir=PATH\t\tSet the executable installation path.",
		 "\t--cmdname=PATH\t\tSet the installed executable name.",
		 "    -h, --help\t\t\tPrint this message.");
      exit;
   }

   # Set bindir --> PREFIX/bin if not explicitly set
   if (not defined $options{bindir}) {
      $options{bindir} = $options{prefix} . '/bin'
   }

   # Read Makefile_template
   open TEMPLATE, 'Makefile_template';
   undef $/;
   my $template = <TEMPLATE>;

   # Output Makefile
   print "Generating Makefile...\n";
   open MAKEFILE, '>Makefile';
   printf MAKEFILE $template, $options{bindir} . '/' . $options{cmdname}
}
